cmake_minimum_required(VERSION 2.8.3)

IF(NOT DEFINED ENV{ROCM_PATH})
    SET(ROCM_PATH /opt/rocm)
ELSE()
    SET(ROCM_PATH $ENV{ROCM_PATH})
ENDIF()

if(NOT DEFINED HIP_PATH)
    if(NOT DEFINED ENV{HIP_PATH})
        set(HIP_PATH ${ROCM_PATH}/hip CACHE PATH "Path to which HIP has been installed")
    else()
        set(HIP_PATH $ENV{HIP_PATH} CACHE PATH "Path to which HIP has been installed")
    endif()
endif()
set(CMAKE_MODULE_PATH "${HIP_PATH}/cmake" ${CMAKE_MODULE_PATH})
# HCC_PATH
IF(NOT DEFINED ENV{HCC_PATH})
    SET(HCC_PATH ${ROCM_PATH}/hcc)
ELSE()
    SET(HCC_PATH $ENV{HCC_PATH})
ENDIF()

# HSA_PATH
IF(NOT DEFINED ENV{HSA_PATH})
    SET(HSA_PATH ${ROCM_PATH}/hsa)
ELSE()
    SET(HSA_PATH $ENV{HSA_PATH})
ENDIF()

project(hipvx_sample CXX)

find_package(HIP QUIET)
if(HIP_FOUND)
    message(STATUS "Found HIP: " ${HIP_VERSION})
else()
    message(FATAL_ERROR "Could not find HIP. Ensure that HIP is either installed in /opt/rocm/hip or the variable HIP_PATH is set to point to the right location.")
endif()
if(HIP_COMPILER STREQUAL clang)
    set(hip_library_name amdhip64)
else()
    set(hip_library_name hip_hcc)
endif()
message("HIP library name: ${hip_library_name}")

project(hipvx_sample)
set (CMAKE_CXX_STANDARD 14)
list (APPEND SOURCES main.cpp)

include_directories (${ROCM_PATH}/include ${ROCM_PATH}/mivisionx/include ${HIP_PATH}/include ${HCC_PATH}/include ${HSA_PATH}/include)
list(APPEND HIP_CXX_FLAGS -std=c++14)
link_directories(${ROCM_PATH}/mivisionx/lib ${HIP_PATH}/lib)
hip_add_executable(hipvx_sample ${SOURCES})
target_compile_options(hipvx_sample PUBLIC ${HIP_CXX_FLAGS})
target_link_libraries(hipvx_sample openvx pthread ${hip_library_name})
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++14 -msse4.2")
